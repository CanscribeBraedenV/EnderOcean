[gd_scene load_steps=47 format=2]

[ext_resource path="res://addons/zylann.hterrain/hterrain_texture_set.gd" type="Script" id=1]
[ext_resource path="res://terrains/demo_level/data.hterrain" type="Resource" id=2]
[ext_resource path="res://addons/zylann.hterrain/hterrain.gd" type="Script" id=3]
[ext_resource path="res://terrains/demo_level/grass/Ground037_1K_Color.jpg" type="Texture" id=4]
[ext_resource path="res://terrains/demo_level/hard_stones/Gravel032_1K_AmbientOcclusion.jpg" type="Texture" id=5]
[ext_resource path="res://terrains/demo_level/hard_stones/Gravel032_1K_NormalGL.jpg" type="Texture" id=6]
[ext_resource path="res://terrains/demo_level/soft_stones/Gravel030_1K_Roughness.jpg" type="Texture" id=7]
[ext_resource path="res://terrains/demo_level/grass/Ground037_1K_NormalGL.jpg" type="Texture" id=8]
[ext_resource path="res://terrains/demo_level/stones/Ground039_1K_NormalGL.jpg" type="Texture" id=9]
[ext_resource path="res://terrains/demo_level/stones/Ground039_1K_Roughness.jpg" type="Texture" id=10]
[ext_resource path="res://scenes/water.tscn" type="PackedScene" id=11]
[ext_resource path="res://assets/models/plants/textures/Moss03/Moss003_1K_Color.jpg" type="Texture" id=12]
[ext_resource path="res://scripts/level.gd" type="Script" id=13]
[ext_resource path="res://assets/models/plants/monsterra.obj" type="ArrayMesh" id=14]
[ext_resource path="res://assets/models/plants/senecio_1.obj" type="ArrayMesh" id=15]
[ext_resource path="res://assets/models/vehicles/monocycle.obj" type="ArrayMesh" id=16]
[ext_resource path="res://scenes/rope/rope.gd" type="Script" id=17]
[ext_resource path="res://scenes/bluerovheavy/BlueRovHeavy.tscn" type="PackedScene" id=18]
[ext_resource path="res://assets/models/vehicles/textures/rust/MetalPlates011_1K_Color.jpg" type="Texture" id=19]
[ext_resource path="res://assets/sounds/Ender-Ambient-Underwater-Loop.wav" type="AudioStream" id=20]
[ext_resource path="res://scripts/delivery_object.gd" type="Script" id=21]

[sub_resource type="Resource" id=1]
script = ExtResource( 1 )
mode = 0
textures = [ [ ExtResource( 4 ), ExtResource( 10 ), ExtResource( 7 ), ExtResource( 5 ) ], [ ExtResource( 6 ), ExtResource( 6 ), ExtResource( 8 ), ExtResource( 9 ) ] ]

[sub_resource type="SpatialMaterial" id=7]
albedo_texture = ExtResource( 19 )

[sub_resource type="ConvexPolygonShape" id=8]
points = PoolVector3Array( -8.96819, 44.0004, 2.14732, -11.4884, 42.3971, 2.60581, -11.4884, 42.3971, 2.83516, -8.28011, 42.1679, 2.60581, -11.0299, 41.0219, 0.772661, -10.3422, 44.0004, 1.00201, -8.28011, 42.1679, 1.23115, -10.1132, 44.0004, 2.83516, -9.42639, 41.9391, 2.83516, -9.40825, 43.0978, 0.7318, -10.8004, 44.0004, 1.4605, -9.42639, 44.4594, 1.4605, -11.2592, 41.9391, 0.772661, -10.3422, 41.0219, 0.772661, -11.2592, 43.5421, 2.83516, -8.28011, 42.8547, 1.23115, -10.3422, 44.4594, 2.37647, -8.28011, 42.8547, 2.60581, -9.42639, 44.2296, 2.60581 )

[sub_resource type="ConvexPolygonShape" id=9]
points = PoolVector3Array( -10.5711, 44.001, 0.772661, -10.5711, 44.001, -0.831457, -5.75987, 42.3973, 0.314149, -11.0295, 41.2514, 0.772661, -6.44743, 41.0222, -0.831457, -6.21824, 41.2514, 0.772661, -11.7176, 42.1681, -0.831457, -9.65432, 43.3132, -1.519, -6.44743, 42.6256, -0.831457, -11.7176, 43.3132, 0.772661, -10.3419, 42.1681, -1.519, -11.4878, 44.001, -0.831457, -8.73874, 41.0222, -0.831457, -10.8003, 41.0222, 0.543405, -6.44743, 42.6256, 0.772661, -11.7176, 41.9389, 0.543405, -5.98906, 41.4806, -0.601977, -9.42513, 42.1681, -1.519 )

[sub_resource type="ConvexPolygonShape" id=10]
points = PoolVector3Array( 18.8238, 4.17932, 0.719234, 8.90735, 5.04267, -2.66429, 8.90735, 5.95947, -2.66429, 8.90735, 5.95947, 2.83462, 18.5314, 5.95947, -1.06026, 9.20901, 3.9509, 1.81073, 18.5314, 3.66781, -1.06026, 9.20901, 3.9509, -1.6404, 15.7807, 5.2717, 2.14672, 18.6375, 5.87755, 0.722885, 8.90735, 4.12654, 2.37602, 18.3843, 3.75937, 0.928079, 15.7807, 5.2717, -1.97639, 10.7832, 3.75519, 0.719613, 14.7818, 4.40316, 2.13804, 9.1375, 5.04267, 2.83462, 13.9505, 5.95947, 1.91795, 18.9017, 5.24344, -0.559788, 11.5219, 4.20382, -1.94804, 18.7595, 4.12654, -1.06026 )

[sub_resource type="ConvexPolygonShape" id=11]
points = PoolVector3Array( 14.6589, 0.560759, -0.655012, 18.6524, 3.53098, 0.717763, 18.7448, 3.56847, -0.562219, 10.7491, 3.57183, -0.563561, 12.5747, 0.918085, 1.00174, 13.0175, 3.9509, 1.41972, 16.9275, 0.918085, 1.00174, 16.9275, 1.14723, -1.06067, 10.9713, 3.66781, -1.06067, 12.3456, 0.918085, -0.831188, 18.5309, 3.66781, -1.06067, 10.7422, 3.20919, 1.00174, 18.5309, 2.52175, 1.00174, 18.5309, 2.29227, -0.831188, 10.9713, 2.29227, -0.831188, 12.5747, 1.14723, -1.06067, 14.2724, 0.511239, 0.660142, 16.6976, 0.688941, -0.831188, 18.7599, 3.20919, 1.00174, 10.9713, 2.52175, 1.00174, 12.8045, 0.688941, -0.831188 )

[sub_resource type="ConvexPolygonShape" id=12]
points = PoolVector3Array( -11.4883, 7.56431, -0.143891, -10.1129, 10.3136, 0.543181, -10.1129, 10.3136, -0.602022, -7.36345, 6.18864, -0.37308, -9.66813, 5.94702, 1.37837, -9.66812, 5.94715, -1.43713, -11.7176, 10.3136, 1.23075, -11.7176, 10.3136, -1.28959, -7.82205, 6.41798, 1.00156, -8.28022, 6.41798, -1.28959, -10.6978, 5.9361, 0.356318, -11.7176, 8.25113, 0.77237, -11.7176, 8.25113, -0.83121, -10.5715, 9.85494, 1.23075, -7.59275, 6.87627, 0.0850506, -10.5715, 9.85494, -1.28959, -10.4376, 5.94338, -0.926553, -7.59275, 6.41798, -0.83121, -8.28022, 6.18864, 1.23075, -11.7176, 9.1673, 1.23075, -11.7176, 9.39625, -1.28959, -10.1812, 5.9425, 1.12459 )

[sub_resource type="ConvexPolygonShape" id=13]
points = PoolVector3Array( -9.88401, 6.18841, -1.06008, -7.13428, 5.95918, 3.06374, -10.3421, 5.95918, 3.06374, -8.50982, 3.89698, -1.74758, -7.13428, 5.95918, -2.89341, -7.26306, 3.96136, 1.81491, -11.7176, 5.04269, -1.51842, -9.65475, 3.89698, 1.00124, -10.8001, 5.04269, 2.83457, -10.8001, 5.95918, -2.66425, -11.7176, 5.95918, 1.68874, -7.13428, 5.04269, -2.89341, -10.3421, 5.04269, -2.89341, -11.7176, 5.04269, 1.68874, -7.13428, 5.04269, 3.06374, -7.24214, 3.9509, -1.66132, -7.36354, 6.18841, -0.830919, -9.42594, 6.18841, 1.23041, -11.7176, 5.95918, -1.51842, -8.28011, 3.89698, 1.91791, -9.65475, 3.89698, -0.830919, -10.3421, 5.04269, 3.06374 )

[sub_resource type="ConvexPolygonShape" id=14]
points = PoolVector3Array( -11.7172, 42.6261, 2.83516, -8.96761, 43.0844, 9.02264, -8.96761, 42.1677, 9.02264, -12.1753, 42.855, 8.10506, -9.42639, 43.5427, 2.83516, -9.42639, 41.9386, 2.83516, -10.343, 41.7094, 9.02264, -12.1753, 43.5427, 8.10506, -11.4879, 43.5427, 2.83516, -9.19716, 43.5427, 9.02264, -9.19716, 43.3136, 2.83516, -10.343, 41.9386, 2.83516, -11.9464, 42.6261, 3.29365, -10.8005, 43.3136, 9.02264, -9.42639, 41.7094, 8.56355, -9.19716, 42.1677, 3.29365 )

[sub_resource type="ConvexPolygonShape" id=15]
points = PoolVector3Array( -8.96806, 41.4805, -3.35215, -9.19713, 43.5425, -1.74835, -8.96806, 43.3133, -1.74835, -10.8009, 42.168, -1.74835, -10.5716, 43.3133, -3.5815, -8.28029, 41.2511, -1.97749, -8.96806, 43.3133, -3.35215, -10.3425, 41.7098, -3.35215, -8.05095, 41.9388, -3.12301, -10.5716, 43.5425, -1.74835, -9.42594, 42.168, -1.519, -9.65475, 43.5425, -3.5815, -10.3425, 41.7098, -1.74835, -8.05095, 41.9388, -1.97749, -10.5716, 42.168, -3.5815, -10.8009, 43.3133, -3.35215 )

[sub_resource type="ConvexPolygonShape" id=16]
points = PoolVector3Array( -9.65522, 43.5427, -3.58257, -10.3423, 41.7094, -9.08094, -9.42608, 41.7094, -9.08094, -10.5714, 43.5427, -9.08094, -10.5714, 42.1677, -3.58257, -9.19693, 43.5427, -9.08094, -9.19693, 42.1677, -3.58257, -10.5714, 43.3136, -3.58257, -10.8006, 42.1677, -9.08094, -8.96761, 42.1677, -9.08094, -9.19693, 43.3136, -3.58257, -9.42608, 41.9386, -3.58257, -10.8006, 43.3136, -8.62234, -8.96761, 43.0844, -8.62234, -10.3423, 41.9386, -3.58257 )

[sub_resource type="ConvexPolygonShape" id=17]
points = PoolVector3Array( -6.44721, 40.5628, 0.772661, -8.96761, 36.8969, -0.602246, -8.73802, 36.8969, -0.831502, -8.73802, 41.0211, -0.602246, -6.44721, 41.0211, -0.831502, -7.59275, 36.8969, 0.772661, -8.73802, 41.0211, 0.543405, -7.13464, 36.8969, -0.373147, -8.73802, 36.8969, 0.772661, -6.21815, 41.0211, 0.543405, -7.36369, 37.1266, -0.831502, -8.27964, 41.0211, 0.772661, -6.21815, 40.1046, 0.0850505, -7.13464, 37.1266, 0.543405, -8.27964, 41.0211, -0.831502, -8.96761, 37.5849, 0.543405, -6.21815, 40.5628, -0.602246 )

[sub_resource type="ConvexPolygonShape" id=18]
points = PoolVector3Array( -9.65522, 39.4174, 1.23086, -10.8006, 40.5628, 0.543495, -10.8006, 40.5628, 1.00169, -9.19693, 36.8969, -0.143869, -10.1131, 38.0431, 0.772527, -10.3423, 41.0211, 0.543495, -8.96761, 37.8142, -0.143869, -8.8789, 36.9493, 0.292293, -10.1131, 38.7307, 1.23086 )

[sub_resource type="ConvexPolygonShape" id=19]
points = PoolVector3Array( 8.8291, 5.92784, -0.38325, 15.7809, 10.0217, 0.314329, 15.7945, 10.039, -0.0861507, 19.4473, 5.9599, -0.602066, 13.9491, 5.9599, 1.91849, 10.7415, 9.62537, 0.542957, 10.0542, 6.87658, -1.28983, 18.76, 7.10586, 1.45967, 15.3727, 9.41301, -1.06103, 9.77663, 5.9361, 1.47219, 19.2186, 8.47983, -0.373125, 13.4508, 9.16554, 1.24971, 18.76, 6.64773, -1.28983, 10.7415, 9.62537, -0.373125, 9.77663, 5.9361, -1.30737, 19.4473, 5.9599, 0.772213, 18.9888, 8.7091, 0.542957, 15.7164, 9.18051, 1.26332, 10.7415, 7.56399, 1.45967, 9.1382, 6.18917, 1.00147, 12.8044, 6.41845, 1.91849, 13.2209, 9.2087, -1.05072, 18.3015, 5.9599, -1.06058, 15.5418, 9.77072, 0.890954, 16.9666, 8.82941, -1.07256, 13.5929, 10.0381, -0.0859592, 15.5818, 9.82315, -0.677907, 18.76, 6.64773, 1.45967, 9.36694, 6.87658, -0.831322, 13.9491, 6.41845, 1.91849, 10.5127, 9.39651, 0.542957 )

[sub_resource type="ConvexPolygonShape" id=20]
points = PoolVector3Array( -15.8426, 14.8976, -0.143824, -11.9473, 19.021, 0.0849832, -11.9473, 19.021, -0.143824, -10.8014, 15.356, -0.372968, -14.009, 15.585, 1.68933, -13.7799, 18.792, -1.74817, -14.4671, 19.021, 1.2307, -13.5508, 13.9803, -1.51869, -11.2595, 15.1266, 1.2307, -15.1548, 13.9803, 1.45985, -10.5718, 18.3336, -0.602111, -12.4054, 18.563, 1.68933, -15.3839, 13.9803, -1.28954, -11.2595, 15.1266, -1.28954, -14.6967, 19.021, -0.831255, -12.6345, 13.9803, 0.543271, -12.4054, 18.563, -1.74817, -10.8014, 18.563, 0.543271, -15.8426, 13.9803, 0.772414, -14.9258, 18.792, 0.314127, -13.7799, 18.792, 1.68933, -14.009, 15.585, -1.74817, -13.5508, 13.9803, 1.45985, -15.613, 14.6687, -1.0604, -11.0304, 15.1266, 1.00156, -12.6345, 13.9803, -0.372968 )

[sub_resource type="ConvexPolygonShape" id=21]
points = PoolVector3Array( -16.7204, 10.4566, 0.0759575, -12.6348, 13.9803, 0.77237, -12.7941, 13.6616, -0.5025, -10.1141, 10.3136, 0.0848711, -16.0706, 10.3136, -1.51871, -14.4671, 10.3136, 1.45987, -15.6167, 13.8002, 0.693589, -13.5513, 13.9803, -1.51871, -11.2601, 10.3136, -1.28954, -13.5513, 13.9803, 1.45987, -11.0313, 10.3136, 1.2307, -15.6103, 13.795, -0.750174, -16.0706, 10.772, 1.45987, -10.573, 11.0013, -0.602044, -16.7583, 10.772, -0.83121, -10.3436, 10.543, 0.77237, -14.9376, 13.7327, -1.31755, -14.9515, 13.7485, 1.27157, -15.8249, 13.8015, 0.0737244, -16.3001, 11.2303, 1.2307, -14.4671, 10.3136, -1.51871, -16.5288, 11.2303, -1.06038 )

[sub_resource type="ConvexPolygonShape" id=22]
points = PoolVector3Array( -14.4684, 10.3136, 1.45964, -20.8841, 4.45327, -0.754678, -20.4387, 4.04917, -0.95541, -16.5296, 1.15604, 0.899248, -11.7176, 10.3136, -1.28954, -20.1952, 8.7076, 0.771876, -16.3016, 8.479, -2.43566, -13.4735, 2.63492, -0.742186, -12.6352, 5.95855, 1.45964, -16.3016, 8.479, 2.37682, -20.4579, 2.80225, 0.693664, -17.1463, 1.16825, -0.95541, -20.1952, 8.7076, -0.830717, -11.7176, 10.3136, 1.2307, -12.0761, 4.43225, -0.134926, -12.6352, 6.18812, -1.51848, -18.4536, 9.76842, -0.349824, -14.6903, 1.39964, 0.685608, -19.003, 1.36633, -0.750423, -16.346, 5.11005, 1.90811, -16.3484, 5.11369, -1.94146, -20.684, 4.86795, 0.905508, -15.0906, 1.57968, -0.955411, -16.1116, 9.89453, -1.39182, -15.385, 8.02179, -2.43566, -18.61, 1.53699, 0.906954, -15.385, 8.25039, 2.37682, -20.0213, 2.81948, -0.953746, -16.8983, 5.10999, 1.90859, -13.4637, 2.62614, 0.685619, -18.8207, 8.7076, -1.51848, -18.8207, 8.7076, 1.45964, -20.425, 8.7076, 0.313992, -17.5665, 0.926866, 0.695865, -16.1188, 0.95708, -0.749792, -17.1794, 10.0483, -0.13728, -15.0798, 1.55114, 0.903511, -18.4524, 9.76563, 0.290779, -16.8934, 5.11363, -1.94192, -20.2493, 3.21687, 0.900609, -20.4465, 2.80975, -0.750405, -20.8971, 4.45048, 0.698004, -19.0102, 1.35462, 0.693682, -11.7176, 9.62588, 1.2307, -18.5918, 8.93814, 1.45964, -14.6961, 1.41232, -0.742175, -11.7176, 9.62588, -1.28954, -18.9938, 1.79208, -0.953804, -20.844, 5.48863, -0.747996, -12.2242, 4.46398, 0.277837, -16.1176, 0.943659, 0.693134, -17.5634, 0.939847, -0.752594 )

[sub_resource type="ConvexPolygonShape" id=23]
points = PoolVector3Array( -7.3641, 36.2076, -0.373147, -14.0947, 18.7921, -0.146696, -14.0946, 18.7923, 0.0880148, -12.056, 18.2435, -0.403156, -12.2944, 18.3068, 0.837004, -8.96815, 36.8969, 0.772661, -8.96815, 36.666, -0.831502, -12.3349, 18.3174, -0.917673, -7.59371, 36.2076, 0.772661, -13.55, 19.7113, 0.772661, -13.55, 19.7113, -0.831502, -7.59371, 36.8969, -0.831502, -9.65569, 35.52, -0.143734, -7.3641, 35.9784, 0.314306, -12.0559, 18.2436, 0.344312, -10.3432, 32.5406, 0.543405, -12.1749, 25.6702, -0.602246, -7.82268, 34.6033, -0.602246, -7.3641, 36.8969, 0.543405, -13.6614, 18.6763, 0.803841, -13.6615, 18.6759, -0.862715, -9.19776, 36.8969, -0.373147, -13.55, 20.8572, 0.314306, -7.82268, 34.1449, -0.143734 )

[sub_resource type="ConvexPolygonShape" id=24]
points = PoolVector3Array( 8.90735, 5.04258, 2.83457, -7.13428, 5.04258, -2.89341, -7.13428, 5.95947, -2.89341, -7.13428, 5.95947, 3.06374, -6.68011, 3.95556, 1.81413, 8.48946, 3.9509, -1.6521, 8.90735, 5.95947, -2.66425, 8.44884, 5.95947, 3.06374, 6.38553, 4.1265, 2.60541, -6.7164, 3.9509, -1.6521, -7.13428, 5.04258, 3.06374, 8.44884, 5.04258, -2.89341, 8.45318, 3.95556, 1.81413, 8.44884, 5.04258, 3.06374, 8.90735, 4.1265, 2.37624, 8.44884, 5.95947, -2.89341, 8.90735, 5.04258, -2.66425, 8.90735, 5.95947, 2.83457 )

[sub_resource type="GDScript" id=25]
script/source = "# Licensed under the MIT License.
# Copyright (c) 2018-2020 Jaccomo Lorenz (Maujoe)

extends Spatial

# User settings:
# General settings
export var enabled = true setget set_enabled

# See https://docs.godotengine.org/en/latest/classes/class_input.html?highlight=Input#enumerations
export(int, \"Visible\", \"Hidden\", \"Captured, Confined\") var mouse_mode = Input.MOUSE_MODE_CAPTURED

enum Freelook_Modes {MOUSE, INPUT_ACTION, MOUSE_AND_INPUT_ACTION}

# Freelook settings
export var freelook = true
export (Freelook_Modes) var freelook_mode = 2
export (float, 0.0, 1.0) var sensitivity = 0.5
export (float, 0.0, 0.999, 0.001) var smoothness = 0.5 setget set_smoothness
export (int, 0, 360) var yaw_limit = 360
export (int, 0, 360) var pitch_limit = 360

# Pivot Settings
export(NodePath) var privot setget set_privot
export var distance = 5.0 setget set_distance
export var rotate_privot = false
export var collisions = true setget set_collisions

# Movement settings
export var movement = true
export (float, 0.0, 5.0) var acceleration = 5.0
export (float, 0.0, 0.0, 1.0) var deceleration = 0.1
export var max_speed = Vector3(15.0, 15.0, 15.0)
export var local = true

# Input Actions
export var rotate_left_action = \"\"
export var rotate_right_action = \"\"
export var rotate_up_action = \"\"
export var rotate_down_action = \"\"
export var forward_action = \"player_up\"
export var backward_action = \"player_down\"
export var left_action = \"player_left\"
export var right_action = \"player_right\"
export var up_action = \"camera_upwards\"
export var down_action = \"camera_downwards\"
export var trigger_action = \"camera_trigger\"

# Gui settings
export var use_gui = true
export var gui_action = \"ui_cancel\"

# Intern variables.
var _mouse_offset = Vector2()
var _rotation_offset = Vector2()
var _yaw = 0.0
var _pitch = 0.0
var _total_yaw = 0.0
var _total_pitch = 0.0

var _direction = Vector3(0.0, 0.0, 0.0)
var _speed = Vector3(0.0, 0.0, 0.0)
var _gui

var _triggered=false

const ROTATION_MULTIPLIER = 500

func _ready():
	_check_actions([
		forward_action,
		backward_action,
		left_action,
		right_action,
		gui_action,
		up_action,
		down_action,
		rotate_left_action,
		rotate_right_action,
		rotate_up_action,
		rotate_down_action
	])

	if privot:
		privot = get_node(privot)
	else:
		privot = null

	set_enabled(enabled)


func _input(event):
		if len(trigger_action)!=0:
			if event.is_action_pressed(trigger_action):
				_triggered=true
			elif event.is_action_released(trigger_action):
				_triggered=false
		else:
			_triggered=true
		if freelook and _triggered:
			if event is InputEventMouseMotion:
				_mouse_offset = event.relative
				
#			_rotation_offset.x = Input.get_action_strength(rotate_right_action) - Input.get_action_strength(rotate_left_action)
#			_rotation_offset.y = Input.get_action_strength(rotate_down_action) - Input.get_action_strength(rotate_up_action)
	
		if movement and _triggered:
			_direction.x = Input.get_action_strength(right_action) - Input.get_action_strength(left_action)
			_direction.y = Input.get_action_strength(up_action) - Input.get_action_strength(down_action)
			_direction.z = Input.get_action_strength(backward_action) - Input.get_action_strength(forward_action)

func _process(delta):
	if _triggered:
		_update_views(delta)

func _update_views(delta):
	if privot:
		_update_distance()
	if freelook:
		_update_rotation(delta)
	if movement:
		_update_movement(delta)

func _physics_process(delta):
	if _triggered:
		_update_views_physics(delta)

func _update_views_physics(delta):
	# Called when collision are enabled
	_update_distance()
	if freelook:
		_update_rotation(delta)

	var space_state = get_world().get_direct_space_state()
	var obstacle = space_state.intersect_ray(privot.get_translation(),  get_translation())
	if not obstacle.empty():
		set_translation(obstacle.position)

func _update_movement(delta):
	var offset = max_speed * acceleration * _direction

	_speed.x = clamp(_speed.x + offset.x, -max_speed.x, max_speed.x)
	_speed.y = clamp(_speed.y + offset.y, -max_speed.y, max_speed.y)
	_speed.z = clamp(_speed.z + offset.z, -max_speed.z, max_speed.z)

	# Apply deceleration if no input
	if _direction.x == 0:
		_speed.x *= (1.0 - deceleration)
	if _direction.y == 0:
		_speed.y *= (1.0 - deceleration)
	if _direction.z == 0:
		_speed.z *= (1.0 - deceleration)

	if local:
		translate(_speed * delta)
	else:
		global_translate(_speed * delta)

func _update_rotation(delta):
	var offset = Vector2();
	
	if not freelook_mode == Freelook_Modes.INPUT_ACTION:
		offset += _mouse_offset * sensitivity
	if not freelook_mode == Freelook_Modes.MOUSE: 
		offset += _rotation_offset * sensitivity * ROTATION_MULTIPLIER * delta
	
	_mouse_offset = Vector2()

	_yaw = _yaw * smoothness + offset.x * (1.0 - smoothness)
	_pitch = _pitch * smoothness + offset.y * (1.0 - smoothness)

	if yaw_limit < 360:
		_yaw = clamp(_yaw, -yaw_limit - _total_yaw, yaw_limit - _total_yaw)
	if pitch_limit < 360:
		_pitch = clamp(_pitch, -pitch_limit - _total_pitch, pitch_limit - _total_pitch)

	_total_yaw += _yaw
	_total_pitch += _pitch

	if privot:
		var target = privot.get_translation()
		var dist = get_translation().distance_to(target)

		set_translation(target)
		rotate_y(deg2rad(-_yaw))
		rotate_object_local(Vector3(1,0,0), deg2rad(-_pitch))
		translate(Vector3(0.0, 0.0, dist))

		if rotate_privot:
			privot.rotate_y(deg2rad(-_yaw))
	else:
		rotate_y(deg2rad(-_yaw))
		rotate_object_local(Vector3(1,0,0), deg2rad(-_pitch))

func _update_distance():
	var t = privot.get_translation()
	t.z -= distance
	set_translation(t)

func _update_process_func():
	# Use physics process if collision are enabled
	if collisions and privot:
		set_physics_process(true)
		set_process(false)
	else:
		set_physics_process(false)
		set_process(true)

func _check_actions(actions=[]):
	if OS.is_debug_build():
		for action in actions:
			if not InputMap.has_action(action):
				print('WARNING: No action \"' + action + '\"')

func set_privot(value):
	privot = value
	_update_process_func()
	if len(trigger_action)!=0:
		_update_views(0)

func set_collisions(value):
	collisions = value
	_update_process_func()

func set_enabled(value):
	enabled = value
	if enabled:
		Input.set_mouse_mode(mouse_mode)
		set_process_input(true)
		_update_process_func()
	else:
		set_process(false)
		set_process_input(false)
		set_physics_process(false)

func set_smoothness(value):
	smoothness = clamp(value, 0.001, 0.999)

func set_distance(value):
	distance = max(0, value)
"

[sub_resource type="SpatialMaterial" id=2]
albedo_color = Color( 0.286275, 0.2, 0, 1 )

[sub_resource type="SpatialMaterial" id=3]
albedo_texture = ExtResource( 12 )

[sub_resource type="SpatialMaterial" id=4]
albedo_texture = ExtResource( 12 )

[sub_resource type="SpatialMaterial" id=5]
albedo_color = Color( 0.301961, 0.14902, 0, 1 )

[sub_resource type="SpatialMaterial" id=6]
albedo_color = Color( 0.129412, 0.345098, 0.141176, 1 )

[node name="demo_level" type="Spatial"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -7.03865, 0, 0 )
script = ExtResource( 13 )
vehicle_path = NodePath("BlueRov")

[node name="water" parent="." instance=ExtResource( 11 )]
transform = Transform( 30, 0, 0, 0, 128, 0, 0, 0, 30, -16.5923, 2.22568, -20.9698 )

[node name="sun" type="DirectionalLight" parent="."]
transform = Transform( 1, 0, 0, 0, 0.615483, 0.78815, 0, -0.78815, 0.615483, 0, 33.518, -56 )
shadow_enabled = true

[node name="HTerrain" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -50, 0, -50 )
script = ExtResource( 3 )
__meta__ = {
"_edit_lock_": true
}
ambient_wind = 0.556
lod_scale = 5.0
_terrain_data = ExtResource( 2 )
chunk_size = 32
collision_enabled = true
collision_layer = 1
collision_mask = 1
shader_type = "Classic4Lite"
custom_shader = null
custom_globalmap_shader = null
texture_set = SubResource( 1 )
shader_params/u_ground_uv_scale = 20
shader_params/u_depth_blending = true
shader_params/u_triplanar = true
shader_params/u_tile_reduction = Plane( 0, 0, 0, 0 )

[node name="Bicycle" type="RigidBody" parent="."]
collision_layer = 2
collision_mask = 3
mode = 1
script = ExtResource( 21 )
__meta__ = {
"_edit_group_": true
}

[node name="monocycle" type="MeshInstance" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
mesh = ExtResource( 16 )
skeleton = NodePath("../../HTerrain")
material/0 = SubResource( 7 )

[node name="CollisionShape17" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 8 )

[node name="CollisionShape16" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 9 )

[node name="CollisionShape15" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 10 )

[node name="CollisionShape14" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 11 )

[node name="CollisionShape13" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 12 )

[node name="CollisionShape12" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 13 )

[node name="CollisionShape11" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 14 )

[node name="CollisionShape10" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 15 )

[node name="CollisionShape9" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 16 )

[node name="CollisionShape8" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 17 )

[node name="CollisionShape7" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 18 )

[node name="CollisionShape6" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 19 )

[node name="CollisionShape5" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 20 )

[node name="CollisionShape4" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 21 )

[node name="CollisionShape3" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 22 )

[node name="CollisionShape2" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 23 )

[node name="CollisionShape" type="CollisionShape" parent="Bicycle"]
transform = Transform( 0.0197017, 0.000851461, -0.00333433, -0.00335217, 0.000365802, -0.0197137, -0.000778286, 0.0199785, 0.000503059, -12.0781, -2.18134, -3.46175 )
shape = SubResource( 24 )

[node name="playerCamera" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.7902, 0 )
visible = false
script = SubResource( 25 )

[node name="Camera" type="Camera" parent="playerCamera" groups=["cameras"]]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -7, 0 )
visible = false
far = 275.0

[node name="BlueRov" parent="." instance=ExtResource( 18 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2, -0.9, 1.9 )

[node name="theter" type="Spatial" parent="BlueRov"]
script = ExtResource( 17 )
start = NodePath("../BlueRov")
loops = 100

[node name="monsterra" type="MeshInstance" parent="."]
transform = Transform( 0.04, 0, 0, 0, 0.14, 0, 0, 0, 0.04, -10.1639, -2.39533, -5.6685 )
mesh = ExtResource( 14 )
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="senecio_1" type="MeshInstance" parent="."]
transform = Transform( 0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, -8.77319, -2.58715, -4.12362 )
mesh = ExtResource( 15 )
material/0 = SubResource( 5 )
material/1 = SubResource( 6 )

[node name="senecio_2" type="MeshInstance" parent="."]
transform = Transform( 0.110841, 0.00251459, 0.0382594, 0, 0.11982, -0.00546888, -0.0459801, 0.00606178, 0.0922297, -8.93666, -2.50577, -5.51956 )
mesh = ExtResource( 15 )
skeleton = NodePath("../senecio_1")
material/0 = SubResource( 5 )
material/1 = SubResource( 6 )

[node name="senecio_3" type="MeshInstance" parent="."]
transform = Transform( 0.0373994, 0.00259398, 0.033084, 0.000893392, 0.0497503, -0.00491062, -0.0331735, 0.00426423, 0.0371663, -8.7081, -2.4246, -6.34672 )
mesh = ExtResource( 15 )
skeleton = NodePath("../senecio_1")
material/0 = SubResource( 5 )
material/1 = SubResource( 6 )

[node name="senecio_4" type="MeshInstance" parent="."]
transform = Transform( 0.0209437, 0.00145263, 0.0185271, 0.000500299, 0.0278601, -0.00274995, -0.0185772, 0.00238797, 0.0208131, -8.39247, -2.54195, -4.88695 )
mesh = ExtResource( 15 )
skeleton = NodePath("../senecio_1")
material/0 = SubResource( 5 )
material/1 = SubResource( 6 )

[node name="senecio_5" type="MeshInstance" parent="."]
transform = Transform( 0.461839, 0.0104775, 0.191298, 0, 0.499252, -0.0273445, -0.191584, 0.0252575, 0.461148, -10.9541, -2.82554, -5.68131 )
mesh = ExtResource( 15 )
skeleton = NodePath("../senecio_1")
material/0 = SubResource( 5 )
material/1 = SubResource( 6 )

[node name="monsterra2" type="MeshInstance" parent="."]
transform = Transform( 0.04, 0, 0, 0, 0.14, 0, 0, 0, 0.04, -10.804, -2.37022, -5.69414 )
mesh = ExtResource( 14 )
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="monsterra3" type="MeshInstance" parent="."]
transform = Transform( 0.04, 0, 0, 0, 0.14, 0, 0, 0, 0.04, -9.51708, -2.39533, -5.21436 )
mesh = ExtResource( 14 )
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="monsterra4" type="MeshInstance" parent="."]
transform = Transform( 0.02, 0, 0, 0, 0.08, 0, 0, 0, 0.03, -8.36455, -2.39533, -5.6685 )
mesh = ExtResource( 14 )
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="monsterra5" type="MeshInstance" parent="."]
transform = Transform( 0.03, 0, 0, 0, 0.11, 0, 0, 0, 0.04, -9.51708, -2.39533, -6.64266 )
mesh = ExtResource( 14 )
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="monsterra6" type="MeshInstance" parent="."]
transform = Transform( 0.03, 0, 0, 0, 0.11, 0, 0, 0, 0.04, -11.5171, -2.39533, -6.64266 )
mesh = ExtResource( 14 )
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="monsterra7" type="MeshInstance" parent="."]
transform = Transform( 0.02, 0, 0, 0, 0.11, 0, 0, 0, 0.04, -11.5171, -2.39533, -5.21436 )
mesh = ExtResource( 14 )
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="monsterra8" type="MeshInstance" parent="."]
transform = Transform( 0.032, 0, 0, 0, 0.112, 0, 0, 0, 0.032, -10.3233, -2.99895, -1.22789 )
mesh = ExtResource( 14 )
skeleton = NodePath("../monsterra")
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="monsterra9" type="MeshInstance" parent="."]
transform = Transform( 0.04, 0, 0, 0, 0.04, 0, 0, 0, 0.02, -9.32327, -2.99895, -1.22789 )
mesh = ExtResource( 14 )
skeleton = NodePath("../monsterra")
material/0 = SubResource( 2 )
material/1 = SubResource( 3 )
material/2 = SubResource( 4 )

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource( 20 )
autoplay = true
